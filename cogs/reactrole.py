import nextcord
import settings
from utils.languageembed import languageEmbed
from nextcord.ext import commands


class ReactRole(commands.Cog):
    def __init__(self, bot: commands.AutoShardedBot):
        self.bot = bot

    @commands.command()
    @commands.has_permissions(administrator=True)
    async def setreactrole(
        self, ctx: commands.Context, emoji, role: nextcord.Role, *, text
    ):
        languageserver = await settings.collectionlanguage.find_one(
            {"guild_id": ctx.guild.id}
        )
        if languageserver is None:
            message = await ctx.send(embed=languageEmbed.languageembed(self, ctx))
            await message.add_reaction("üëç")

        else:

            if role >= ctx.guild.me.top_role:
                embed = nextcord.Embed(
                    title="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡πå",
                    description="‡∏¢‡∏®‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏ó‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏¢‡∏®‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á",
                    colour=0x983925,
                )
                embed.set_footer(text="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 15‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                embed.set_image(
                    url="https://smilewinbot.web.app/assets/image/host/role.png"
                )
                await ctx.send(embed=embed, delete_after=15)
            else:
                if "//" in text:
                    text = text.replace("//", "\n")

                embed = nextcord.Embed(colour=0x00FFFF, description=text)
                message = await ctx.send(embed=embed)
                await message.add_reaction(emoji)

                newrole = {
                    "guild_id": ctx.guild.id,
                    "emoji": emoji,
                    "message_id": message.id,
                    "message": text,
                    "role_give_id": role.id,
                }
                await settings.collectionrole.insert_one(newrole)

    @setreactrole.error
    async def setreactrole_error(self, ctx: commands.Context, error):
        languageserver = await settings.collectionlanguage.find_one(
            {"guild_id": ctx.guild.id}
        )
        if languageserver is None:
            message = await ctx.send(embed=languageEmbed.languageembed(self, ctx))
            await message.add_reaction("üëç")

        else:
            server_language = languageserver["Language"]

            if server_language == "Thai":
                if isinstance(error, commands.MissingPermissions):
                    embed = nextcord.Embed(
                        colour=0x983925,
                        title="‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤",
                        description=f"‚ö†Ô∏è ``{ctx.author}`` ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ``‡πÄ‡πÄ‡∏≠‡∏î‡∏°‡∏¥‡∏ô`` ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ",
                    )

                    embed.set_footer(text=f"‚îóRequested by {ctx.author}")

                    message = await ctx.send(embed=embed)
                    await message.add_reaction("‚ö†Ô∏è")

            if server_language == "English":
                if isinstance(error, commands.MissingPermissions):
                    embed = nextcord.Embed(
                        colour=0x983925,
                        title="You don't have permission",
                        description=f"‚ö†Ô∏è ``{ctx.author}`` You must have ``Administrator`` to be able to use this command",
                    )

                    embed.set_footer(text=f"‚îóRequested by {ctx.author}")

                    message = await ctx.send(embed=embed)
                    await message.add_reaction("‚ö†Ô∏è")


def setup(bot: commands.Bot):
    bot.add_cog(ReactRole(bot))
